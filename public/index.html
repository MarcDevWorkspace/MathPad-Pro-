<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MathPad Pro (Dev)</title>

    <!-- Path relative to index.html (which is in public/) -->
    <link rel="stylesheet" href="style.css">

    <!-- Path relative to index.html (which is in public/) -->
    <script src="mathjax-config.js"></script>

    <!-- Load MathJax Library AFTER the configuration object is defined -->
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <!-- Or use tex-mml-svg.js if SVG output is preferred -->

</head>
<body class="light-mode"> <!-- Default to light, JS can toggle via MathEditor or theme manager -->

    <div id="app-container">
        <!-- Header from MathPadPro-mockup_v2.html, with MathJax readiness in mind -->
        <header id="app-header">
            <button id="menu-btn" class="icon-btn" aria-label="Open menu">
                <svg viewBox="0 0 24 24"><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"></path></svg>
            </button>
            <div id="document-title-wrapper">
                <input type="text" id="document-title-input" value="My Math Notes" aria-label="Document title">
            </div>
            <div id="header-actions">
                <button id="undo-btn" class="icon-btn" aria-label="Undo">
                    <svg viewBox="0 0 24 24"><path d="M12.5 8c-2.65 0-5.05.99-6.9 2.6L2 7v9h9l-3.62-3.62c1.39-1.16 3.16-1.88 5.12-1.88 3.54 0 6.55 2.31 7.6 5.5l2.37-.78C20.08 11.99 16.63 8 12.5 8z"></path></svg>
                </button>
                <button id="redo-btn" class="icon-btn" aria-label="Redo">
                    <svg viewBox="0 0 24 24"><path d="M18.4 10.6C16.55 8.99 14.15 8 11.5 8c-4.13 0-7.63 3.01-8.87 7.02l-2.37-.78C1.92 10.31 6.46 6 11.5 6c2.74 0 5.26 1.21 7.01 3.22L22 6v9h-9l3.4-3.4z"></path></svg>
                </button>
            </div>
        </header>

        <!-- Sidebar structure from MathPadPro-mockup_v2.html -->
        <div id="sidebar-overlay"></div>
        <nav id="sidebar">
            <div id="sidebar-content">
                <ul>
                    <li><a href="#" class="active" aria-label="Current Document">
                        <svg viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"></path></svg>
                        Current Document
                    </a></li>
                    <li><a href="#" aria-label="New Document">
                        <svg viewBox="0 0 24 24"><path d="M13.78 4.22a.75.75 0 0 0-1.06 0l-2.25 2.25a.75.75 0 0 0 0 1.06l2.25 2.25a.75.75 0 0 0 1.06-1.06L12.56 7.5h5.69a.75.75 0 0 0 0-1.5h-5.69l1.22-1.22a.75.75 0 0 0 0-1.06zM4.75 3A1.75 1.75 0 0 0 3 4.75v14.5A1.75 1.75 0 0 0 4.75 21h7.5a.75.75 0 0 0 0-1.5H4.75a.25.25 0 0 1-.25-.25V4.75c0-.14.11-.25.25-.25h14.5a.25.25 0 0 1 .25.25v7.5a.75.75 0 0 0 1.5 0v-7.5A1.75 1.75 0 0 0 19.25 3H4.75z"></path></svg>
                        New Document
                    </a></li>
                    <li><a href="#" aria-label="Open Document">
                        <svg viewBox="0 0 24 24"><path d="M4.75 3A1.75 1.75 0 0 0 3 4.75v14.5A1.75 1.75 0 0 0 4.75 21h5.954a.75.75 0 0 0 .628-.356l2.75-4.5a.75.75 0 0 1 .644-.372h4.524A1.75 1.75 0 0 0 21 13.524V4.75A1.75 1.75 0 0 0 19.25 3H4.75zm0 1.5h14.5a.25.25 0 0 1 .25.25v7.024a.25.25 0 0 1-.25.25h-4.524a2.25 2.25 0 0 0-1.933 1.116l-2.75 4.5a.25.25 0 0 1-.209.11H4.75a.25.25 0 0 1-.25-.25V4.75a.25.25 0 0 1 .25-.25z"></path></svg>
                        Open...
                    </a></li>
                    <li><a href="#" aria-label="Settings">
                        <svg viewBox="0 0 24 24"><path d="M11.92 3.515a1.25 1.25 0 0 1 1.16 0l8.25 4.867A1.25 1.25 0 0 1 22 9.57v4.86a1.25 1.25 0 0 1-.67.99l-8.25 4.867a1.25 1.25 0 0 1-1.16 0l-8.25-4.867a1.25 1.25 0 0 1-.67-.99V9.57c0-.504.302-.96.67-1.188l8.25-4.867zM12 4.458 4.5 8.81v6.38l7.5 4.427 7.5-4.427V8.81L12 4.458zm-.755 5.292a.75.75 0 0 0-1.49.15L11 15.25a.75.75 0 0 0 1.49-.15L11.245 9.75zM12 17.25a1 1 0 1 0 0-2 1 1 0 0 0 0 2z"></path></svg>
                        Settings
                    </a></li>
                </ul>
            </div>
            <div id="sidebar-footer">
                 <button id="theme-toggle-btn" class="icon-btn" aria-label="Toggle theme">
                    <svg id="theme-icon-sun" viewBox="0 0 24 24" class="hidden"><path d="M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zm0-2c3.87 0 7 3.13 7 7s-3.13 7-7 7-7-3.13-7-7 3.13-7 7-7zm0-2c.55 0 1 .45 1 1v1c0 .55-.45 1-1 1s-1-.45-1-1V4c0-.55.45-1 1-1zm0 18c.55 0 1 .45 1 1v1c0 .55-.45 1-1 1s-1-.45-1-1v-1c0-.55.45-1 1-1zm-7-2.95c.36.36.36.95 0 1.31l-.71.71c-.36.36-.95.36-1.31 0s-.36-.95 0-1.31l.71-.71c.36-.36.95-.36 1.31 0zm12.73 0c.36.36.36.95 0 1.31l-.71.71c-.36.36-.95.36-1.31 0s-.36-.95 0-1.31l.71-.71c.36-.36.95-.36 1.31 0zM4 12c0 .55-.45 1-1 1H2c-.55 0-1-.45-1-1s.45-1 1-1h1c.55 0 1 .45 1 1zm18 0c0 .55-.45 1-1 1h-1c-.55 0-1-.45-1-1s.45-1 1-1h1c.55 0 1 .45 1 1zm-6.29-7.71c.36.36.95.36 1.31 0l.71-.71c.36-.36.36-.95 0-1.31s-.95-.36-1.31 0l-.71.71c-.36.36-.36.95 0 1.31zm-9.19 9.19c.36.36.95.36 1.31 0l.71-.71c.36-.36.36-.95 0-1.31s-.95-.36-1.31 0l-.71.71c.36.36-.36.95 0 1.31z"/></svg>
                    <svg id="theme-icon-moon" viewBox="0 0 24 24"><path d="M9.5 2.84A9.5 9.5 0 0 0 2.84 9.5c0 2.48 1.01 4.72 2.65 6.35A9.49 9.49 0 0 1 12 2.5a9.49 9.49 0 0 1 6.35 2.65C20.99 14.22 22 11.98 22 9.5A9.5 9.5 0 0 0 9.5 2.84zM12 4a7.5 7.5 0 1 0 0 15 7.5 7.5 0 0 0 0-15z"/></svg>
                    <span id="theme-toggle-text">Switch to Dark Mode</span>
                </button>
            </div>
        </nav>

        <!-- Main content area where MathEditor will mount -->
        <main id="editor-area-wrapper">
            <div id="math-editor-container">
                <!-- MathEditor.ts will replace this -->
                <p style="text-align: center; padding: 40px 20px; color: var(--text-color-secondary);">Initializing Math Editor...</p>
            </div>
        </main>

        <!-- Bottom Toolbar from MathPadPro-mockup_v2.html -->
        <footer id="bottom-toolbar">
            <button class="tool-btn" data-action="insert-fraction" aria-label="Insert fraction">
                <svg viewBox="0 0 24 24"><path d="M4 9h16v2H4zm0 4h16v2H4zm5-6h6v2h-6zm0 8h6v2h-6zM3 6c0-1.1.9-2 2-2h14c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H5c-1.1 0-2-.9-2-2V6zm16 0H5v12h14V6zM11.5 13.5a1 1 0 100-2 1 1 0 000 2z"/></svg>
                Fraction
            </button>
            <button class="tool-btn" data-action="insert-exponent" aria-label="Insert exponent">
                <svg viewBox="0 0 24 24"><text x="4" y="18" font-size="14" style="font-family: var(--font-family-sans);">x</text><text x="12" y="12" font-size="10" style="font-family: var(--font-family-sans);">y</text></svg>
                Exponent
            </button>
            <button class="tool-btn" data-action="insert-subscript" aria-label="Insert subscript">
                 <svg viewBox="0 0 24 24"><text x="4" y="18" font-size="14" style="font-family: var(--font-family-sans);">x</text><text x="12" y="20" font-size="10" style="font-family: var(--font-family-sans);">y</text></svg>
                Subscript
            </button>
            <button class="tool-btn" data-action="insert-sqrt" aria-label="Insert square root">
                <svg viewBox="0 0 24 24"><path d="M18.71 2H17v2h1.71L9.41 16.29l-2.47-1.23L6.22 17l3.47 1.74.3-.6.01-.01L19 5.41V7h2V3c0-.55-.45-1-1-1h-.29zM3 19h10v-2H3v2z"/></svg>
                Root
            </button>
            <button class="tool-btn" data-action="insert-sum" aria-label="Insert summation">
                <svg viewBox="0 0 24 24"><path d="M18 4H6v2l6 7-6 7h12v-2H9.5l5-6-5-6H18V4z"/></svg>
                Sum
            </button>
            <button id="symbol-palette-btn" class="tool-btn" aria-label="Open symbol palette">
                <svg viewBox="0 0 24 24"><path d="M16 20h4v-4h-4v4zm-6 0h4v-4h-4v4zm-6 0h4v-4H4v4zm10-6h4v-4h-4v4zm-6 0h4v-4h-4v4zm-6 0h4v-4H4v4zm10-6h4V4h-4v4zm-6 0h4V4h-4v4zm-6 0h4V4H4v4z"></path></svg>
                More
            </button>
        </footer>

        <!-- Symbol Palette Modal from MathPadPro-mockup_v2.html -->
        <div id="symbol-palette-modal">
            <!-- Symbols will be dynamically populated or handled by MathEditor/VirtualKeyboard logic -->
            <!-- Example structure, content might be generated by JS -->
            <div class="symbol-item" data-insert="\alpha" title="Alpha">$\alpha$</div>
            <div class="symbol-item" data-insert="\beta" title="Beta">$\beta$</div>
            <!-- ... more symbols ... -->
        </div>
    </div>

    <!-- Load compiled application JavaScript -->
    <!-- Path relative to index.html (which is in public/) -->
    <script type="module" src="dist/main.js"></script> 

    <!-- Minimal JS for Sidebar and Theme Toggle -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // This script should ideally be part of your main application bundle (main.ts)
            // or managed by a dedicated UI component/manager.
            // For now, keeping it here for self-contained mockup UI behavior.

            const menuBtn = document.getElementById('menu-btn');
            const sidebar = document.getElementById('sidebar');
            const sidebarOverlay = document.getElementById('sidebar-overlay');
            
            if (menuBtn && sidebar && sidebarOverlay) {
                function toggleSidebar() {
                    sidebar.classList.toggle('open');
                    sidebarOverlay.classList.toggle('visible');
                }
                menuBtn.addEventListener('click', toggleSidebar);
                sidebarOverlay.addEventListener('click', toggleSidebar);
            } else {
                console.warn("Sidebar elements not found for UI interaction script.");
            }

            const themeToggleBtn = document.getElementById('theme-toggle-btn');
            if (themeToggleBtn) {
                const themeToggleText = document.getElementById('theme-toggle-text');
                const sunIcon = document.getElementById('theme-icon-sun');
                const moonIcon = document.getElementById('theme-icon-moon');

                function applyTheme(theme) {
                    if (!sunIcon || !moonIcon || !themeToggleText) return;
                    if (theme === 'dark') {
                        document.body.classList.add('dark-mode');
                        sunIcon.classList.remove('hidden');
                        moonIcon.classList.add('hidden');
                        themeToggleText.textContent = 'Switch to Light Mode';
                    } else {
                        document.body.classList.remove('dark-mode');
                        sunIcon.classList.add('hidden');
                        moonIcon.classList.remove('hidden');
                        themeToggleText.textContent = 'Switch to Dark Mode';
                    }
                }

                const storedTheme = localStorage.getItem('mathpad-theme-preference');
                const preferredTheme = storedTheme ? storedTheme : (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
                applyTheme(preferredTheme); // Apply theme on load

                themeToggleBtn.addEventListener('click', () => {
                    const newTheme = document.body.classList.contains('dark-mode') ? 'light' : 'dark';
                    localStorage.setItem('mathpad-theme-preference', newTheme);
                    applyTheme(newTheme);
                    if (window.MathJax && window.MathJax.typesetPromise) {
                        // MathJax output jaxes (CHTML/SVG) often use CSS variables or `em` units
                        // that should adapt if your CSS theme variables are correctly set up for MathJax elements.
                    }
                });
            } else {
                 console.warn("Theme toggle button not found.");
            }

            const symbolPaletteBtn = document.getElementById('symbol-palette-btn');
            const symbolPaletteModal = document.getElementById('symbol-palette-modal');
            if (symbolPaletteBtn && symbolPaletteModal) {
                 symbolPaletteBtn.addEventListener('click', () => {
                    const isVisible = symbolPaletteModal.classList.toggle('visible');
                    symbolPaletteBtn.classList.toggle('active', isVisible);
                    if (isVisible && window.MathJax && window.MathJax.typesetPromise) {
                        if (symbolPaletteModal.querySelectorAll('.symbol-item[data-insert]').length > 0 && !symbolPaletteModal.dataset.mathjaxProcessed) {
                             MathJax.typesetPromise([symbolPaletteModal]).then(() => {
                                symbolPaletteModal.dataset.mathjaxProcessed = "true";
                             }).catch(err => console.error("Error typesetting symbol palette:", err));
                        }
                    }
                });
            } else {
                console.warn("Symbol palette elements not found.");
            }

            document.querySelectorAll('#bottom-toolbar .tool-btn[data-action]').forEach(button => {
                button.addEventListener('click', () => {
                    const action = button.dataset.action;
                    console.log(`Toolbar action (mock): ${action}`);
                });
            });

        });
    </script>

</body>
</html>